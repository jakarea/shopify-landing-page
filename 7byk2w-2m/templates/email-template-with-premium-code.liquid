{# ======================================================
   PREMIUM BUNDLE REGISTRATION CODE SECTION
   Add this section after the opening <body> tag or after the main header
   ====================================================== #}

{# Generate Premium Bundle Registration Code #}
{% assign SHOPIFY_CODE_SECRET = 'a3f8b2c1d4e5f6789012345678901234567890abcdef1234567890abcdef12' %}
{% assign has_premium_bundle = false %}
{% assign premium_code = '' %}
{% assign registration_url = '' %}

{% for line_item in line_items %}
  {% assign product_title_downcase = line_item.title | downcase %}
  {% if product_title_downcase contains 'premium' %}
    {% assign has_premium_bundle = true %}
    {% assign order_number = order_number %}
    {% assign tier_code = 'P' %}
    {% assign data_to_sign = tier_code | append: '-' | append: order_number %}
    {% assign checksum = data_to_sign | hmac_sha256: SHOPIFY_CODE_SECRET | slice: 0, 8 | upcase %}
    {% assign premium_code = 'VT-' | append: tier_code | append: '-' | append: order_number | append: '-' | append: checksum %}
    {% assign registration_url = 'https://vintedtracker.com/register-with-code?code=' | append: premium_code %}
  {% endif %}
{% endfor %}

{# Display Premium Bundle Section if purchased #}
{% if has_premium_bundle %}
<table class="row section" style="margin-bottom: 30px;">
  <tr>
    <td class="section__cell">
      <center>
        <table class="container" style="background: linear-gradient(135deg, #9333ea 0%, #db2777 100%); border-radius: 16px; padding: 30px;">
          <tr>
            <td style="color: white; text-align: center;">

              {# Header #}
              <h2 style="color: white; font-size: 24px; margin: 0 0 10px 0;">
                ðŸŽ‰ Premium Bundle - Activate Your Account
              </h2>
              <p style="color: rgba(255,255,255,0.9); margin: 0 0 20px 0; font-size: 16px;">
                Thank you for purchasing the Premium Bundle! Use your registration code below to activate your Vinted Tracker Pro account.
              </p>

              {# Code Box #}
              <table style="background: white; border-radius: 12px; padding: 20px; margin: 0 auto 20px auto; max-width: 400px;">
                <tr>
                  <td style="text-align: center;">
                    <p style="color: #666; font-size: 14px; margin: 0 0 8px 0;">Your Registration Code:</p>
                    <code style="display: block; font-size: 20px; font-weight: bold; color: #9333ea; letter-spacing: 2px; padding: 12px; background: #f3f4f6; border-radius: 8px;">
                      {{ premium_code }}
                    </code>
                  </td>
                </tr>
              </table>

              {# CTA Button #}
              <table style="margin: 0 auto;">
                <tr>
                  <td style="padding: 0;">
                    <table class="button main-action-cell">
                      <tr>
                        <td class="button__cell" style="background: white !important;">
                          <a href="{{ registration_url }}" class="button__text" style="color: #9333ea !important; font-size: 16px;">
                            Activate Your Account Now â†’
                          </a>
                        </td>
                      </tr>
                    </table>
                  </td>
                </tr>
              </table>

              {# Note #}
              <p style="color: rgba(255,255,255,0.8); font-size: 13px; margin: 15px 0 0 0;">
                ðŸ’¡ Save this code for future reference. You can also find it on the thank you page.
              </p>

            </td>
          </tr>
        </table>
      </center>
    </td>
  </tr>
</table>

<!-- Spacer after Premium section -->
<table class="row" style="margin-bottom: 30px;">
  <tr>
    <td></td>
  </tr>
</table>
{% endif %}

{# ======================================================
   END - PREMIUM BUNDLE REGISTRATION CODE SECTION
   ====================================================== #}
